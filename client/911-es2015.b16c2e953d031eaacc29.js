(self.webpackChunksparkangular=self.webpackChunksparkangular||[]).push([[911],{86759:function(e,t,s){"use strict";function r(e,t,s,r){return new(s||(s=Promise))(function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?i(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(a,o)}l((r=r.apply(e,t||[])).next())})}s.d(t,{hj:function(){return c},ph:function(){return o},PN:function(){return u}});var i=s(37716),n=s(79765),a=s(38583);class o{constructor(e,t){if(this.platformID=t,this.marketDataConnectedStatus=new n.xQ,this.marketDataConnectedStatus$=this.marketDataConnectedStatus.asObservable(),this.disconnectedReason="",e)throw new Error("InfrontUIService is already loaded.");this.isBrowser=(0,a.NF)(t),this.isBrowser&&(this.isDisconnected=new Infront.Observable(!1))}init(e,t){if(this.isBrowser){let s;if(Infront.ui)s=Infront.ui;else{const r=new Infront.InfrontUIOptions;r.store_session=!1,r.useIds=!0,r.useMws=!1,r.streaming=!0,r.visualWidgetAccess=!1,r.secureConnection=Infront.ConnectionSecurity.Require,r.language="en",t?(r.user_id=e,r.password=t):(r.signed_token=e,r.token_type="JWT"),s=new Infront.UI(r),this.infrontPromise=new Promise(e=>{this.infrontReady=t=>{this.onMdConnected(t),e(s)}}),s.registerEventObserver(Infront.ReadyEvent.kEventName,e=>{this.infrontReady(e)}),s.registerEventObserver(Infront.DisconnectEvent.kEventName,e=>{this.onMdDisconnect(e)}),s.registerEventObserver(Infront.LoginFailedEvent.kEventName,e=>{this.onMdLoginFailed(e)}),s.init()}}}getInfront(){return this.infrontPromise}getModel(){return r(this,void 0,void 0,function*(){return this.getInfront().then(e=>e.getModel())})}onMdConnected(e){this.marketDataConnectedStatus.next(Infront.InfrontStatus.Connected),this.isDisconnected.set(!1)}onMdDisconnect(e){this.lastDisconnectedEvent=e,this.marketDataConnectedStatus.next(Infront.InfrontStatus.Disconnected);var t=e?e.reason:2;switch(this.disconnectedReason=e&&e.message||"",t){case Infront.DisconnectEventReason.KICKOUT:this.isDisconnected.set(!0);case Infront.DisconnectEventReason.DISCONNECT:case Infront.DisconnectEventReason.INVALID_SESSION_TOKEN:case Infront.DisconnectEventReason.UNKNOWN:this.isDisconnected.set(!0)}}onMdLoginFailed(e){this.lastDisconnectedEvent=null,this.marketDataConnectedStatus.next(Infront.InfrontStatus.Disconnected)}ngOnDestroy(){this.reconnectSubscription&&this.reconnectSubscription.unsubscribe()}}o.\u0275fac=function(e){return new(e||o)(i.\u0275\u0275inject(o,12),i.\u0275\u0275inject(i.PLATFORM_ID))},o.\u0275prov=i.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"}),o.ngInjectableDef=(0,i.\u0275\u0275defineInjectable)({factory:function(){return new o((0,i.\u0275\u0275inject)(o,12),(0,i.\u0275\u0275inject)(i.PLATFORM_ID))},token:o,providedIn:"root"});let l=(()=>{class e{constructor(e){this.authService=e}turquoiseToInfrontTicker(e){const t=e.slice(-1),s=e.slice(0,-1);switch(t){case"A":return s+"_AS";case"B":return s+"_BR";case"C":return s+"_CO";case"D":return s+"_DE";case"E":return s+"_MC";case"H":return s+"_HE";case"I":return s+"_I";case"K":return s+"_PR";case"L":return s+"_L";case"M":return s+"_MI";case"N":return s;case"O":return s+"_OL";case"P":return s+"_PA";case"S":return s+"_ST";case"T":return s+"_BU";case"U":return s+"_LS";case"V":return s+"_VI";case"W":case"X":return s;case"Z":return s+"_VX";default:return s}}getInfrontInstrumentFromCode(t,s=IDS.RealtimeTags.Symbol,r=null){if(this.authService.isBrowser)return new Promise((i,n)=>this.authService.getModel().then(a=>{let o=0,l=new Infront.SearchOptions;l.onData=s=>{if(s.length>1){const a=()=>{o++,o==s.length-1&&n("symbol: "+t+" not found")};for(let n of s){let s=n.instrument,o=t;r===e.TURQUOISE_SUFFIX&&(o=this.turquoiseToInfrontTicker(t)),s.ticker.toLowerCase()===o.toLowerCase()?i(new Infront.Instrument(s.feed,s.ticker)):a()}}else if(1==s.length){let e=s[0].instrument;i(new Infront.Instrument(e.feed,e.ticker))}else n("symbol: "+t+" not found")},l.onError=e=>{n("symbol: "+t+" not found, server error: "+e)},l.maxResults=10,l.freeTextTagMustMatch=[s],a.search(r?t+r:t,l)}))}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275inject(o))},e.\u0275prov=i.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e.TURQUOISE_SUFFIX=" TQ",e})();let u=(()=>{class e{constructor(e,t,s){this.authenticationService=e,this.mappingService=t,this.turquoiseOptions={tag:IDS.RealtimeTags.BloombergTicker,codeSuffix:l.TURQUOISE_SUFFIX},this.normalOptions={tag:IDS.RealtimeTags.Symbol,codeSuffix:null},this.field="ONE_Y_HIGH",this.element=s.nativeElement}set code(e){const t=e.split(":");this._code=t.length>1?t[t.length-1]:e}ngOnInit(){!this.authenticationService.isBrowser||this.init()}createComputedHigh(){return{fields:["HIGH","ONE_Y_HIGH"],function:(e,t)=>{let[s,r]=t;return s=isNaN(s)?-1/0:s,Math.max(s,r)}}}createComputedLow(){return{fields:["LOW","ONE_Y_LOW"],function:(e,t)=>{let[s,r]=t;return s=isNaN(s)||0==s?1/0:s,Math.min(s,r)}}}init(){return r(this,void 0,void 0,function*(){const e=this.turquoise?this.turquoiseOptions:this.normalOptions,t=yield this.mappingService.getInfrontInstrumentFromCode(this._code,e.tag,e.codeSuffix);if(this.singleValueOptions=new Infront.InstrumentSingleValueWidgetOptions,"ONE_Y_HIGH_CALC"===this.field){let e=this.createComputedHigh();this.singleValueOptions.computeFields=e.fields,this.singleValueOptions.compute=e.function,this.singleValueOptions.type="computed"}else if("ONE_Y_LOW_CALC"===this.field){let e=this.createComputedLow();this.singleValueOptions.computeFields=e.fields,this.singleValueOptions.compute=e.function,this.singleValueOptions.type="computed"}this.singleValueOptions.instrument=t,this.singleValueOptions.enableChangeStatusColors=!1,this.singleValueOptions.name=this.field,this.singleValueOptions.dataType=Infront.DataType.Numeric,this.singleValueOptions.decimals=2;const s=yield this.authenticationService.getInfront();this.widget=s.instrumentSingleValueWidget(this.element,this.singleValueOptions)})}ngOnDestroy(){this.widget&&this.widget.destroy()}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275directiveInject(o),i.\u0275\u0275directiveInject(l),i.\u0275\u0275directiveInject(i.ElementRef))},e.\u0275dir=i.\u0275\u0275defineDirective({type:e,selectors:[["","single_value",""]],inputs:{field:"field",code:["single_value","code"],turquoise:"turquoise"}}),e})(),c=(()=>{class e{constructor(e){if(e.isBrowser){let e=Infront.languageMap.en||{};Infront.languageMap.en=InfrontUtil.mergeRecursive(e,{chart:{indicators:"Add indicators",searchPlaceholder:"Compare","1D":"Today","5D":"1 week","30D":"1 month","6M":"6 months","1Y":"1 year","5Y":"5 years",ALL:"Max",CUSTOM:"Custom",beta:"Beta FTSE All-Share (21)",historical_volatility:"Volatility (60)",relative_volatility_index:"Rel. Volatility Index (10, 14)",simple_moving_avg:"Simple Moving Avg. (14)",volume:"Volume",volume_weighted_average_price:"VWAP (14)",macd:"MACD (26, 12, 9)",relative_strength_index:"Rel. Strength Index (14)"},chartIndicatores:{beta:"Beta"}}),window.Highcharts.setOptions({time:{useUTC:!0},chart:{height:400},responsive:{rules:[{condition:{maxWidth:639},height:400}]}}),window.Highcharts.chart.height=400}}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275inject(o))},e.\u0275mod=i.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=i.\u0275\u0275defineInjector({providers:[l]}),e})()},52085:function(e){e.exports=function(){"use strict";return function(e,t,s){t.prototype.isBetween=function(e,t,r,i){var n=s(e),a=s(t),o="("===(i=i||"()")[0],l=")"===i[1];return(o?this.isAfter(n,r):!this.isBefore(n,r))&&(l?this.isBefore(a,r):!this.isAfter(a,r))||(o?this.isBefore(n,r):!this.isAfter(n,r))&&(l?this.isAfter(a,r):!this.isBefore(a,r))}}}()},46981:function(e){e.exports=function(){"use strict";return function(e,t,s){t.prototype.isToday=function(){var e="YYYY-MM-DD",t=s();return this.format(e)===t.format(e)}}}()},85416:function(e){e.exports=function(){"use strict";var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(s,r,i){var n,a=function(e,s,r){void 0===r&&(r={});var i=new Date(e);return function(e,s){void 0===s&&(s={});var r=s.timeZoneName||"short",i=e+"|"+r,n=t[i];return n||(n=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:r}),t[i]=n),n}(s,r).formatToParts(i)},o=function(t,s){for(var r=a(t,s),n=[],o=0;o<r.length;o+=1){var l=r[o],u=e[l.type];u>=0&&(n[u]=parseInt(l.value,10))}var c=n[3],h=+t;return(i.utc(n[0]+"-"+n[1]+"-"+n[2]+" "+(24===c?0:c)+":"+n[4]+":"+n[5]+":000").valueOf()-(h-=h%1e3))/6e4},l=r.prototype;l.tz=function(e,t){void 0===e&&(e=n);var s=this.utcOffset(),r=this.toDate(),a=r.toLocaleString("en-US",{timeZone:e}),o=Math.round((r-new Date(a))/1e3/60),l=i(a).$set("millisecond",this.$ms).utcOffset(15*-Math.round(r.getTimezoneOffset()/15)-o,!0);if(t){var u=l.utcOffset();l=l.add(s-u,"minute")}return l.$x.$timezone=e,l},l.offsetName=function(e){var t=this.$x.$timezone||i.tz.guess(),s=a(this.valueOf(),t,{timeZoneName:e}).find(function(e){return"timezonename"===e.type.toLowerCase()});return s&&s.value};var u=l.startOf;l.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return u.call(this,e,t);var s=i(this.format("YYYY-MM-DD HH:mm:ss:SSS"));return u.call(s,e,t).tz(this.$x.$timezone,!0)},i.tz=function(e,t,s){var r=s&&t,a=s||t||n,l=o(+i(),a);if("string"!=typeof e)return i(e).tz(a);var u=function(e,t,s){var r=e-60*t*1e3,i=o(r,s);if(t===i)return[r,t];var n=o(r-=60*(i-t)*1e3,s);return i===n?[r,i]:[e-60*Math.min(i,n)*1e3,Math.max(i,n)]}(i.utc(e,r).valueOf(),l,a),c=u[1],h=i(u[0]).utcOffset(c);return h.$x.$timezone=a,h},i.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},i.tz.setDefault=function(e){n=e}}}()},96472:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,s=/([+-]|\d\d)/g;return function(r,i,n){var a=i.prototype;n.utc=function(e){return new i({date:e,utc:!0,args:arguments})},a.utc=function(t){var s=n(this.toDate(),{locale:this.$L,utc:!0});return t?s.add(this.utcOffset(),e):s},a.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var o=a.parse;a.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),o.call(this,e)};var l=a.init;a.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var u=a.utcOffset;a.utcOffset=function(r,i){var n=this.$utils().u;if(n(r))return this.$u?0:n(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&null===(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var i=(""+r[0]).match(s)||["-",0,0],n=60*+i[1]+ +i[2];return 0===n?0:"+"===i[0]?n:-n}(r)))return this;var a=Math.abs(r)<=16?60*r:r,o=this;if(i)return o.$offset=a,o.$u=0===r,o;if(0!==r){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(o=this.local().add(a+l,e)).$offset=a,o.$x.$localOffset=l}else o=this.utc();return o};var c=a.format;a.format=function(e){return c.call(this,e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":""))},a.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},a.isUTC=function(){return!!this.$u},a.toISOString=function(){return this.toDate().toISOString()},a.toString=function(){return this.toDate().toUTCString()};var h=a.toDate;a.toDate=function(e){return"s"===e&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var f=a.diff;a.diff=function(e,t,s){if(e&&this.$u===e.$u)return f.call(this,e,t,s);var r=this.local(),i=n(e).local();return f.call(r,i,t,s)}}}()},79233:function(e,t,s){"use strict";s.d(t,{G:function(){return c},O:function(){return h}});var r=s(64762),i=s(37716),n=s(86759),a=s(23065),o=s(88335),l=s(38583),u=s(59276),c=(()=>{return(e=c||(c={})).FUND="FUND",e.NONE="NONE",e.ETP="ETP",c;var e})();let h=(()=>{class e{constructor(e,t,s,r,i,n,a,o){this.authService=e,this.store=t,this.platformId=s,this.doc=r,this.zone=i,this.refreshService=n,this.renderer=a,this.chartMdrService=o}ngOnChanges(e){this.pageType=this.content.type.value}ngOnInit(){return(0,r.mG)(this,void 0,void 0,function*(){!(0,l.NF)(this.platformId)||(this.refreshService.setRefreshComponent(this.id,this.position,this.type,this.content,this.status),this.chartMdrService.dispatchPageType(this.pageType),this.chartMdrService.dispatchFundsProperties(this.content))})}ngOnDestroy(){this.refreshService.unsetRefreshComponent(this.id)}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275directiveInject(n.ph),i.\u0275\u0275directiveInject(a.yh),i.\u0275\u0275directiveInject(i.PLATFORM_ID),i.\u0275\u0275directiveInject(l.K0),i.\u0275\u0275directiveInject(i.NgZone),i.\u0275\u0275directiveInject(o.G),i.\u0275\u0275directiveInject(i.Renderer2),i.\u0275\u0275directiveInject(u.o))},e.\u0275cmp=i.\u0275\u0275defineComponent({type:e,selectors:[["app-chart-mdr"]],inputs:{content:"content",id:"id",position:"position",type:"type",status:"status"},features:[i.\u0275\u0275NgOnChangesFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),e})()},70511:function(e,t,s){"use strict";s.d(t,{s:function(){return v}});var r=s(64762),i=s(37716),n=s(58385),a=s(12978),o=s(81322),l=s(23065),u=s(31478),c=s(88002),h=s(15257),f=s(45435),d=s(38583),m=s(25917),p=s(18978);class v{constructor(){this._appendFirstTab=!0,this.platformId=n.k.get(i.PLATFORM_ID)}get childComponents$(){return this._childComponents$}get childComponentsWithoutMdr$(){var e;return null===(e=this._childComponents$)||void 0===e?void 0:e.pipe((0,c.U)(e=>e.filter(e=>"chart_mdr"!==e.type)))}toggleBaseInit(e){return(0,r.mG)(this,void 0,void 0,function*(){let t=yield this._urlService.getCurrentPath().toPromise();if(t=e||t,this.currentPath=t,!this.tabs||this.tabs.length<1)return;const s=t.parameters.get("tab");let r;s?r=this.tabs.find(e=>e.label.toLowerCase().replace(/\W+/g,"-")===s):(r=this.tabs[0],this.currentPath={path:this.currentPath.path,parameters:this.currentPath.parameters.set("tab",r.label.toLowerCase().replace(/\W+/g,"-"))}),yield this.setTabnavElementActive(r,null,!!e,!0),this._childComponents$=this._store.pipe((0,l.Ys)(u.DA,{id:this._id}))})}setPosition(e){this._position=e}setId(e){this._id=e}setStatus(e){this._status=e}setTabs(e){this.tabs=e.filter(e=>e.type===a.$.internal&&e.modules&&e.modules.length)}setStore(e){this._store=e}setRefreshService(e){this._refreshService=e}setAppendFirstTab(e){this._appendFirstTab=e}setUrlService(e){this._urlService=e}isTabActive(e,t=null){return e?this.isTabIdActive(e):!!t&&this.isTabUriActive(t)}isTabIdActive(e){return!!this._status&&e===this._status.currentTabId}isTabUriActive(e){if(!this.currentPath)return!1;const t=e.replace(/^\/+/g,"");return t===o.$.getNormalUrl(this.currentPath)||t===this.currentPath.path}setTabnavElementActive(e,t,s=!1,i=!1){return(0,r.mG)(this,void 0,void 0,function*(){t&&(0,d.NF)(this.platformId)&&t.preventDefault(),this.setCurrentPathTab(e,yield this.getTabUrl(e).toPromise(),i),this._refreshService.activeTabId=e.tabId,(!this.isTabActive(e.tabId)||s)&&(this.setStatusTabId(e.tabId),yield this.renderTabModules(this._id,this._position,e.modules))})}getTabUrl(e){const t=(null==e?void 0:e.label.toLowerCase().replace(/\W+/g,"-"))||" ";return this._store.pipe((0,l.Ys)(u.Jz),(0,h.q)(1),(0,c.U)(e=>e.parameters.get("tab")===t?e:o.$.getPageUrlWithGlobalRequiredParameters(e)),(0,c.U)(e=>({path:e.path,parameters:e.parameters.set("tab",t)})))}getTabLink(e){return this.getTabUrl(e).pipe((0,f.h)(e=>!!e),(0,c.U)(t=>o.$.getNormalUrl(p.kv.getAliasByRoute(Object.assign(Object.assign({},t),{parameters:t.parameters.delete("page")}),new Map([["tab",e.label.toLowerCase().replace(/\W+/g,"-")]])))))}getTabUriLink(e){if(e.type===a.$.external)return(0,m.of)(e.uri);const t=o.$.getUrlObjectFromString(e.uri,!1);return this._store.pipe((0,l.Ys)(u.Jz),(0,h.q)(1),(0,c.U)(e=>o.$.getPageUrlWithGlobalRequiredParameters(e)),(0,c.U)(e=>this.getCorrectUrl(t,e)))}renderTabModules(e,t,s){return(0,r.mG)(this,void 0,void 0,function*(){return yield this._refreshService.addComponents(e,s.map(e=>e.moduleId),t,"tabId="+this._status.currentTabId,this._status)})}getCorrectUrl(e,t){const s=this.getParameters(e,t);return"ftse-news"===e.path||"ftse-index"===e.path||"ftse-constituents"===e.path?o.$.getLink(e.path,s):o.$.getNormalUrl({path:e.path,parameters:s})}getParameters(e,t){return t.parameters.has("tidm")?e.parameters.set("tidm",t.parameters.get("tidm")):t.parameters.has("indexname")?e.parameters.set("indexname",t.parameters.get("indexname")):e.parameters}setStatusTabId(e){try{this._status.currentTabId=e}catch(t){this._status={currentTabId:e}}}setCurrentPathTab(e,t,s=!1){if(!t)return;const r=(t=this.removeAccordionId(t)).parameters.has("tab")&&!this._appendFirstTab&&e===this.tabs[0]?{path:t.path,parameters:t.parameters.delete("tab")}:t;this._urlService.setCurrentPath(r,s)}removeAccordionId(e){return e.parameters.has("accordionId")?{path:e.path,parameters:e.parameters.delete("accordionId").delete("moduleId")}:e}}},57098:function(e,t,s){"use strict";s.d(t,{l:function(){return i}});var r=s(37716);let i=(()=>{class e{constructor(){this.formats=new Map,this.formatMap()}formatMap(){this.formats.set("short","DD.MM.YY"),this.formats.set("short-month","DD MMM YYYY"),this.formats.set("long","DD MMMM YYYY"),this.formats.set("time","HH:mm:ss"),this.formats.set("filter","YYYYMMDD"),this.formats.set("trades","YYYYMMDDTHHmm"),this.formats.set("filter-trades","YYYY-MM-DDTHH:mm:ss"),this.formats.set("xlsx-date-format","DD-MMM-YYYY"),this.formats.set("short-year","YY")}getFormat(e){return e||(e="short"),this.formats.get(e)}getDateWithTimezone(e,t="Europe/London"){if(!e)return null;const r=s(48873),i=s(96472),n=s(85416);return r.extend(n),r.extend(i),r.tz(e,t).format()}transform(e,t,r,i,n=!1){const a=s(48873);var o=s(46981);a.extend(o);const l=a(e).isToday();if(!e||"-"===e)return e;const u=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})/;(u.test(e.toString())||n&&u.test(e.toString())&&!l)&&(n&&!l||(e=e.toString()+"+00:00"));const c=this.getFormat(t),h=s(96472),f=s(85416);if(a.extend(h),a.extend(f),i){const t=s(52085);a.extend(t),this.isBST=a(a(e).tz(r).format("MM.DD")).isBetween(a(this.lastSunday(3)),a(this.lastSunday(10)))}let d;return r||l&&n?(l&&n&&(r="Europe/London"),e=a(e).tz(r).format(c)):e=a(e).format(c),d=i?this.isBST?" BST":" GMT":"",e+d}lastSunday(e){const t=s(48873),r=t().year(),i=new Date(r,e,1,12),n=i.getDay(),a=0===n?7:n;return t(i.setDate(10===e?i.getDate()-a:i.getDate()-a-1)).format("MM.DD")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=r.\u0275\u0275definePipe({name:"customdate",type:e,pure:!0}),e})()},11627:function(e,t,s){"use strict";s.d(t,{O:function(){return u}});var r=s(64762),i=s(37716),n=s(81322),a=s(95962),o=s(38583),l=s(23065);let u=(()=>{class e{constructor(e,t,s,r){this.filtersService=e,this.location=t,this.store=s,this.urlService=r,this.refreshComponent=new i.EventEmitter,this.refreshComponentTab=new i.EventEmitter,this.scrollTop=new i.EventEmitter,this.filtersService.store=this.store,this.filtersService.urlService=this.urlService}ngOnInit(){this.location.subscribe(e=>this.handler(e))}handler(e){const t=this.getNewCurrentUrl(e.url);return this.isFilterToggle(t)||this.isTabNav(t)?this.handleBackBrowserClickTab(t):this.typeOfComponent||!t.parameters||t.parameters.has("tab")?void 0:this.refreshComponentOnBack(t)}handleBackBrowserClickTab(e){return(0,r.mG)(this,void 0,void 0,function*(){yield this.urlService.setCurrentPath(e,!0),this.refreshComponentTab.emit(e)})}refreshComponentOnBack(e){this.filtersService.clearFilters(),e.parameters.keys().forEach(t=>{const s=this.filtersService.getFilterStructure(e.parameters.getAll(t).toString());this.filtersService.setFilter(t,s)}),this.refreshComponent.emit(e.parameters)}getNewCurrentUrl(e){return n.$.getUrlObjectFromString(e,!0,!0)}isTheirTab(e){const t=e.parameters&&e.parameters.has("tab")?e.parameters.get("tab"):null;return t&&this.togglesList&&!!this.togglesList.find(e=>e.label.toLowerCase().replace(/\s+/g,"-")===t)||!1}isFilterToggle(e){return"filter-toggle"===this.typeOfComponent&&this.isTheirTab(e)||"reports-filter-toggle"===this.typeOfComponent}isTabNav(e){return!!e.parameters&&e.parameters.has("tab")&&"tab-nav"===this.typeOfComponent&&this.isTheirTab(e)}}return e.\u0275fac=function(t){return new(t||e)(i.\u0275\u0275directiveInject(a.I),i.\u0275\u0275directiveInject(o.Ye),i.\u0275\u0275directiveInject(l.yh),i.\u0275\u0275directiveInject(n.$))},e.\u0275dir=i.\u0275\u0275defineDirective({type:e,selectors:[["","appBackBrowserClick",""]],inputs:{typeOfComponent:"typeOfComponent",togglesList:"togglesList"},outputs:{refreshComponent:"refreshComponent",refreshComponentTab:"refreshComponentTab",scrollTop:"scrollTop"}}),e})()},59276:function(e,t,s){"use strict";s.d(t,{o:function(){return l}});var r=s(23065),i=s(31478),n=s(46782),a=s(79765),o=s(37716);let l=(()=>{class e{constructor(e){this.store=e,this.ngUnsubscribe=new a.xQ,this.pageType$=this.store.pipe((0,r.Ys)(i.C2),(0,n.R)(this.ngUnsubscribe)),this.fundProperties$=this.store.pipe((0,r.Ys)(i.Cu),(0,n.R)(this.ngUnsubscribe))}dispatchPageType(e){this.store.dispatch(i.pN({pageType:e}))}dispatchFundsProperties(e){this.store.dispatch(i.WD({fundsProperties:e}))}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}}return e.\u0275fac=function(t){return new(t||e)(o.\u0275\u0275inject(r.yh))},e.\u0275prov=o.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},95962:function(e,t,s){"use strict";s.d(t,{I:function(){return c}});var r=s(64762),i=s(91841),n=s(25917),a=s(81322),o=s(57098),l=s(25746),u=s(37716);let c=(()=>{class e{constructor(){this.filters=[],this._counters=new Map,this._firstLevelFilters=null,this._activeFirstLevels=null,this._reset=!1,this.removedFilters=[]}get store(){return this._store}set store(e){this._store=e}get counters(){return this._counters}set firstLevelFilters(e){this._firstLevelFilters=e}get activeFirstLevels(){return this._activeFirstLevels}set activeFirstLevels(e){this._activeFirstLevels=e}get reset(){return this._reset}set reset(e){this._reset=e}set urlService(e){this._urlService=e}set scrollToService(e){this._scrollToService=e}set scrollElementId(e){this._scrollElementId=e}set scrollElementRef(e){this._scrollElementRef=e}setFilter(e,t,s=0,r=null){if(e){if(this._reset="initial"===e,["beforedate","afterdate"].includes(e))this.handleSetDateFilter(e);else{if("newsType"===e)return this.handleNewsTYpeFilter(t,s,r);["issuers","q","codes"].includes(e)&&this.deleteCompanyFilters(),"period"===e&&this.deleteDateFilters(),this.deleteFilter(e,t.key)}this.filters.push({name:e,filter:t,level:s,parent:r})}}handleNewsTYpeFilter(e,t=0,s="News type"){this.deleteFiltersByParent(s),"only"===e.key&&(this.deleteFilter("headlinetypes","1,2,5"),this.deleteFilter("headlinetypes",""),this.deleteFilter("excludeheadlines","82,79"),this.deleteFilter("excludeheadlines","")),"except"===e.key&&(this.deleteFilter("headlinetypes","1,2,5"),this.deleteFilter("headlinetypes",""),this.filters.push({name:"excludeheadlines",filter:{key:"82,79",value:"Show all except NAV & FRN"},level:t,parent:s}),this.filters.push({name:"headlinetypes",filter:{key:"",value:""},level:t,parent:s})),"all"===e.key&&(this.filters.push({name:"headlinetypes",filter:{key:"",value:"Show all"},level:t,parent:s}),this.filters.push({name:"excludeheadlines",filter:{key:"",value:""},level:t,parent:s}))}handleSetDateFilter(e){const t=this.filters.filter(t=>t.name===e);if(t.length>0){const s=t.shift();this.deleteFilter(e,s.filter.key)}}deleteFilter(e,t){this.filters=["couponrate","currentyield","yieldtomaturity","codes","freetext","namecode"].includes(e)?this.filters.filter(t=>t.name!==e):this.filters.filter(s=>s.name!==e||s.filter.key!==t),this.removedFilters.push({name:e,key:t}),void 0===e&&"company"===t.toLowerCase()&&(this.filters=this.filters.filter(e=>"world"!==e.name),this.removedFilters.push({name:"world",key:null}))}deleteAllFiltersOfCategory(e){if(e.subFilters){if("date"===e.subFilters.name)return this.deleteDateFilters();if("company"===e.subFilters.name||"companyInstrument"===e.subFilters.name)return this.deleteCompanyFilters();this.filters=this.filters.filter(t=>t.name!==e.subFilters.name),this.deleteAllSubFilters(e)}}deleteAllSubFilters(e){this._counters.delete(e.key),e.subFilters&&e.subFilters.filters&&!(e.subFilters.filters.length<1)&&e.subFilters.filters.forEach(t=>{this.deleteFilter(e.subFilters.name,t.key),this.deleteAllSubFilters(t)})}deleteDateFilters(){this.resetCounter("Admission date"),["beforedate","afterdate"].forEach(e=>this.handleSetDateFilter(e))}deleteFiltersByLevel(e){this.filters=this.filters.filter(t=>t.level!==e)}deleteFiltersByParent(e=null){this.filters=this.filters.filter(t=>t.parent!==e)}deleteCompanyFilters(){this.resetCounter("Company");const e=["issuers","codes","q"];this.filters=this.filters.filter(t=>!e.includes(t.name)),e.forEach(e=>this.removedFilters.push({name:e,key:null}))}clearFilters(){this.activeFirstLevels=null;const e=this.filters.map(e=>({name:e.name,key:e.filter.key}));this.removedFilters=this.removedFilters&&this.removedFilters.length>0?this.removedFilters.concat(e):e,this.clearPageFilter(),this.filters=[],this._counters.clear(),this._reset=!0}clearPageFilter(){this.removedFilters.push({name:"page",key:null})}clearAlphabetFilter(){this.deleteFiltersByParent("initial"),this.removedFilters.push({name:"initial",key:null})}getHttpFilters(){let e=new i.LE;for(const t of this.filters)e=e.append(t.name,t.filter.key);return e}getFilters(e=!1){e?this._urlService.getCurrentPath().subscribe(e=>{this.setFiltersFromUrl(e.parameters)}):this.setFiltersFromUrl(this.getHttpFilters());let t=[];return this.filters.filter(e=>"showonlylse"!==e.name&&"custom"!==e.filter.key&&"world"!==e.name).forEach(e=>{const s=t.find(t=>t.name===e.name&&t.level===e.level&&t.parent===e.parent);s?s.value.push(`${e.filter.value}`):t.push({name:e.name,value:[`${e.filter.value}`],level:e.level,parent:e.parent})}),t=this.formatDateFilters(t),(0,n.of)(this.formatSummaryFilters(t))}formatSummaryFilters(e){let t=[];return e.forEach(e=>{const s=t.find(t=>t.name===e.parent);s?s.value=s.value.concat(e.value):t.push(Object.assign(Object.assign({},e),{name:e.parent}))}),t.forEach(e=>{e.value.forEach(s=>{const r=t.filter(e=>e.parent===s);r.length>0&&(e.value=e.value.filter(e=>e!==s),r.forEach(t=>{t.name=e.name,t.value=[s,...t.value],3===t.level&&s!==e.parent&&(t.parent=e.parent)}))});const s=e.value.shift();e.value=[s,e.value.join(", ")].filter(e=>e),3===e.level&&(e.value=[e.parent,...e.value])}),t=t.map(e=>Object.assign(Object.assign({},e),{value:e.level<=1?[e.value.join(", ")]:e.value})),t.filter(e=>e.value.length>1||1===e.value.length&&""!==e.value[0])}formatDateFilters(e){const t=e.filter(e=>["beforedate","afterdate"].includes(e.name));if(t.length>1){e=e.filter(e=>!["beforedate","afterdate"].includes(e.name));const s=t.find(e=>"beforedate"===e.name),r=t.find(e=>"afterdate"===e.name);e.push({name:"betweendate",level:0,parent:"betweendate",value:[r.value[0].replace("after","between")+s.value[0].replace("before"," and")]})}return e}isActiveFilter(e,t){for(const s of this.filters)if(s.name===e&&s.filter.key===t)return!0;return!1}activeFiltersOnLevel(e,t){for(const s of this.filters)if(s.level===e&&(e>=1&&s.parent===t||e<=1))return!0;return!1}addFiltersToUrl(e,t=!1){return(0,r.mG)(this,void 0,void 0,function*(){let s=yield this._urlService.getCurrentPath().toPromise();this.removedFilters.filter(e=>void 0!==e.name).forEach(e=>{s=["page","headlinetypes","excludeheadlines","freetext","namecode"].includes(e.name)?Object.assign(Object.assign({},s),{parameters:s.parameters.delete(e.name)}):Object.assign(Object.assign({},s),{parameters:s.parameters.delete(e.name,`${e.key}`)}),["issuers","codes","q"].includes(e.name)&&(s=Object.assign(Object.assign({},s),{parameters:s.parameters.delete(e.name)}),s=Object.assign(Object.assign({},s),{parameters:s.parameters.delete("world")}))}),this.removedFilters=[];const r=yield this.getFilters().toPromise();let n=r&&r.length>0?this.getHttpFilters():new i.LE;e&&(n=e),yield this._urlService.setCurrentPath(a.$.addParametersToUrl(s,n),t)})}setFiltersFromUrl(e){!this._firstLevelFilters||(this._firstLevelFilters.filters.forEach(t=>{if(this.resetCounter(t.key),"exploreStoriesFilters"===t.subFilters.name)var s=e.getAll("filters");else s=e.getAll(`${t.subFilters.name}`);((0,l.fJ)(e).includes("filters")||(0,l.fJ)(e).includes(t.subFilters.name))&&!t.subFilters.filters&&this.incrementCounter(t.key),s&&t.subFilters.filters&&t.subFilters.filters.forEach(r=>{if(this.resetCounter(r.key),(s.includes(r.key)||s.includes(r.key.toString()))&&(this.setFilter(t.subFilters.name,r,1,t.key),this.incrementCounter(t.key)),r.subFilters){if("exploreStoriesFilters"===t.subFilters.name)var i=e.getAll("filters");else i=e.getAll(`${r.subFilters.name}`);!i||!r.subFilters.filters||r.subFilters.filters.forEach(t=>{if(this.resetCounter(t.key),(i.includes(t.key)||i.includes(t.key.toString()))&&(this.setFilter(r.subFilters.name,t,2,r.value),this.incrementCounter(r.key)),!t.subFilters)return;const s=e.getAll(`${t.subFilters.name}`);!s||!t.subFilters.filters||t.subFilters.filters.forEach(e=>{(s.includes(e.key)||s.includes(e.key.toString()))&&(this.setFilter(t.subFilters.name,e,3,t.value),this.incrementCounter(t.key))})})}})}),this.handleDateFiltersFromUrl(e),this.handleSearchFiltersFromUrl(e),this.handleOtherFiltersFromUrl(e),this.handleNewsTypeFiltersFromUrl(e))}handleDateFiltersFromUrl(e){const t=e.get("beforedate");if(t){const e={key:t,value:`before ${(new o.l).transform(t,"long")}`};this.setFilter("beforedate",e,0,"beforedate")}const s=e.get("afterdate");if(s){const e={key:s,value:`after ${(new o.l).transform(s,"long")}`};this.setFilter("afterdate",e,0,"afterdate")}}handleOtherFiltersFromUrl(e){["showonlylse","couponrate","currentyield","yieldtomaturity","world","initial"].forEach(t=>{const s=e.get(`${t}`);s&&s.split(",").forEach(e=>this.setFilter(t,{key:e,value:e},0,t))})}handleSearchFiltersFromUrl(e){const t=["issuers","codes","q"];[...t,"freetext","namecode"].forEach(s=>{const r=e.getAll(`${s}`);if(r){const e=r.toString();this.setFilter(s,{key:e,value:e},0,s),t.includes(s)&&this.incrementCounter("Company")}})}handleNewsTypeFiltersFromUrl(e){this.incrementCounter("News type");const t=e.getAll("excludeheadlines"),s=e.getAll("headlinetypes"),r=t?t.join(","):"",i=s?s.join(","):"";this.setNewsType(t,r,s,i)}setNewsType(e=null,t=null,s=null,r=null){!e||t||!s||r?e&&t&&s&&!r&&this.setFilter("newsType",{key:"except",value:"Show all except NAV & FRN"},0,"News type"):this.setFilter("newsType",{key:"all",value:"Show all"},0,"News type")}incrementCounter(e){this._counters.set(e,(this._counters.get(e)||0)+1)}decrementCounter(e){!this._counters.get(e)||(this._counters.set(e,this._counters.get(e)-1),this._counters.get(e)<=0&&this._counters.delete(e))}getCounters(){return(0,n.of)(this._counters)}resetCounter(e){!this._counters.get(e)||(this._counters.set(e,0),this._counters.delete(e))}getFilterStructure(e){return{key:e,value:e}}getActiveFiltersByName(e){return this.filters.filter(t=>t.name===e)}isOnlyOnePageOrParams(e,t,s){return e&&t>=0||s&&s.keys().length>0}isAllSelectedAndSubmit(e){return 0===this.filters.length&&!0===e}scrollToResults(e,t,s=!1,i=!1){return(0,r.mG)(this,void 0,void 0,function*(){if(t.isRefreshAuto)return;const r=this.getHttpFilters(),n=yield this._urlService.getPageFromCurrentPath(),a=this.isOnlyOnePageOrParams(e,n,r),o=this.isAllSelectedAndSubmit(s);(a&&!1===s||o)&&(i&&o&&(yield this._urlService.cleanParameters()),this._scrollToService.scrollToTheElementById(this._scrollElementId,this._scrollElementRef))})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=u.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);